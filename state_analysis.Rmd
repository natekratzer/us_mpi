---
title: "R Notebook"
output: html_notebook
---

```{r}
library(tidyverse)
library(geofacet)
```

```{r}
state_df <- read_csv("state_year_mpi.csv")
```

```{r}
state_fips <- read_csv("C:/Users/natek/Google Drive/Dissertation/state names and medicaid.csv")
```

```{r}
state_df <- left_join(state_df, state_fips, by = "STATEFIP")
```


```{r}
p <- ggplot(state_df, aes(year, adj_hc *100)) +
  geom_line() +
  scale_x_continuous(labels = function(x) paste0("'", substr(x, 3, 4))) +
  scale_y_continuous(breaks = c(4, 7, 10)) +
  #theme(axis.text = element_blank(), axis.ticks = element_blank()) +
  facet_geo(~st_abr) +
  labs(title = "Multidimensional Poverty in U.S. states from 2013 to 2016", x = "Year", y = "Adjusted Headcount",
       caption = "Source: Author's analysis of American Community Survey data via IPUMS")
```


# state bar chart
```{r}
bplot_df <- state_df %>%
  filter(year == 2016) %>%
  select(st_abr, per_con_dim_edu, per_con_dim_hlth, per_con_dim_inc) %>%
  mutate(Health = per_con_dim_hlth * 100, Education = per_con_dim_edu*100, Economic = per_con_dim_inc * 100) %>%
  gather(key = "Dimension", value = "value", Health, Education, Economic)

p <- ggplot(bplot_df, aes(Dimension, value, fill = Dimension)) +
  geom_col() +
  coord_flip() + 
  facet_geo(~st_abr) +
  labs(title = "Percent Contribution by Dimension", x = "Dimension", y = "Percent Contribution",
       caption = "Source: Author's analysis of American Community Survey data via IPUMS")
```



# choroplethr map
```{r}

region <- tolower(state_df$State[state_df$year == 2016])
value <- state_df$adj_hc[state_df$year == 2016]
value <- round(value * 100, 1)
plt_map_df <- data.frame(region, value)
plt_map <- state_choropleth(plt_map_df)
plt_map <- plt_map + labs(title = "Adjusted Headcount, 2016") + theme(plot.title = element_text(hjust = 0.5))
```

#calculate correlation coefficient for state income poverty. 
```{r}
state_df_16 <- state_df %>% filter(year == 2016)
state_df_16 <- state_df_16 %>% arrange(adj_hc)
```
